# 運用可用性集建立高穩定（HA）架構

虛擬機器不是放上雲端平台就可以高枕無憂，因為機房可能會有預期的維護、系統升級、或是不預期的意外等等造成虛擬機器服務中斷或產生問題。Microsoft Azure 提供免費的**可用性集（availability set）**的功能，讓您能透過它建立起高穩定（HA, high availability）的系統架構，降低系統或服務中斷的風險，而透過可集建立的服務架構，Microsoft Azure 承諾 99.95 的服務水準。

> 99.95

## 可用性集的容錯域（Fault Domain）及更新域（Update Domain）

首先，想要建立 HA 架構就是希望能盡可能地減低因為機房、網路、實體設備等發生意外或升級維護時所造成服務中斷的風險，但並不是你任意建立多個虛擬機器就能保證的，這就是為什麼要使用可用性集的緣故，它提供了兩個概念來規劃你建立的虛擬機器：

* **容錯域（Fault Domain）** 在可用性集中，容錯域的數量就代表這個可用性集會把虛擬機器**分佈在幾個不同的機櫃**之中，主要就是避免虛擬機器建立在相同的機櫃中，增加了因為硬體故障就同時發生問題的風險。

* **更新域（Update Domain）** 更新域讓你可以將虛擬機器分成不同的群組，每次新增虛擬機器進可用性集時就會放在另一個更新域。當 Azure 機房在進行系統升級或預定維護作業時，會一次處理一個群組，對使用者而言就是一次只會重啟同一群內的虛擬機器，但順序是不固定的。

舉例來說，假設你有 A, B, C, D, E, F, G 七台虛擬機器，而建了一個有 3 個容錯域、5 個更新域的可用性集把這些虛擬機器放進來，那機器的容錯域及更新域可能會是這樣：

| VM | 容錯域 | 更新域 |
| --- | --- | --- |
| A | 0 | 0 |
| B | 1 | 1 |
| C | 2 | 2 |
| D | 0 | 3 |
| E | 1 | 4 |
| F | 2 | 0 |
| G | 0 | 1 |

這表示 ABC 分別在不同的機櫃（同理：DEF 也是，但 ADG 是同機櫃）；而 Azure 在升級與維護時一次只會重啟一個更新域，所以當 AF 一起被重啟時，其它 VM 不受影響。

## 建立可用性集

### 從 Web 管理界面操作

\(待寫\)

### 從命令列工具操作

\(待寫\)

## 參考資料

* [1]: [Azure 虛擬機器的服務水準 \(SLA\) 保證](https://azure.microsoft.com/support/legal/sla/virtual-machines/)
* [管理虛擬機器的可用性](https://docs.microsoft.com/zh-tw/azure/virtual-machines/virtual-machines-linux-manage-availability)



